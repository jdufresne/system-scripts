- name: Install Ruby
  dnf:
    name:
      - ruby
      - ruby-devel
      - rubygem-bundler
  become: yes

- name: Install RVM GPG keys
  command:
    argv:
      - gpg
      - --keyserver
      - hkp://keys.gnupg.net
      - --recv-keys
      - 409B6B1796C275462A1703113804BB82D39DC0E3
      - 7D2BAF1CF37B13E2069D6956105BD0E739499BDB

- name: Download RVM
  get_url:
    url: https://get.rvm.io
    dest: "{{ cache_dir }}/rvm-installer"
  register: rvm_download

- name: Install RVM
  command:
    argv:
      - bash
      - "{{ rvm_download.dest }}"
      - stable
    creates: ~/.rvm/bin/rvm

- name: Install Ruby versions
  command:
    argv:
      - ~/.rvm/bin/rvm
      - install
      - "ruby-{{ item }}"
    creates: "~/.rvm/rubies/ruby-{{ item }}/bin/ruby"
  loop:
    - 3.1.2

- name: Set default Ruby version
  command:
    argv:
      - ~/.rvm/bin/rvm
      - alias
      - create
      - default
      - ruby-3.1.2
    creates: "~/.rvm/rubies/default/bin/ruby"
