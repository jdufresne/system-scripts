- name: Enable Google Chrome YUM repository
  ini_file:
    path: /etc/yum.repos.d/google-chrome.repo
    section: google-chrome
    option: enabled
    value: "1"
    mode: 0644
  become: yes

- name: Install Google Chrome
  dnf:
    name:
      - google-chrome-stable
  become: yes

- name: Get Google Chrome version string
  command:
    cmd: google-chrome --version
  register: google_chrome_version_string
  changed_when: true

- name: Extract Google Chrome version
  set_fact:
    chrome_version: "{{ google_chrome_version_string.stdout | regex_replace('^Google Chrome ([0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+) *$', '\\1') }}"

- name: Download ChromeDriver
  get_url:
    url: "https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/{{ chrome_version }}/linux64/chromedriver-linux64.zip"
    dest: "{{ cache_dir }}/chromedriver_linux64-{{ chrome_version }}.zip"
  register: chromedriver

- name: Extract ChromeDriver
  unarchive:
    src: "{{ chromedriver.dest }}"
    dest: ~/.local/bin/
    remote_src: yes
